**------------------------------------------------------------------------------------------------
* @header_start
* WebGrab+Plus ini for grabbing EPG data from TvGuide websites
* @Site: tv.wp.pl
* @MinSWversion: V2.1
*   none
* @Revision 9 - [07/08/2022] doglover
* @Revision 8 - [24/03/2019] doglover
*   new website
* @Revision 7 - [08/11/2015] Jan van Straaten
*   small change in urlshow , added channellist
* @Revision 6 - [01/07/2012] Jan van Straaten/Porek388
*   completely new, site change
* @Revision 5 - [10/02/2012] porek388
*   added duration, changed title + various other changes 
* @Revision 4 - [] 
*   change in description
* @Revision 3 - [] 
*   adapted for 1.0.9
* @Revision 2 - [] 
*   small change in description
* @Remarks:
*   none
* @header_end
**------------------------------------------------------------------------------------------------
site {url=tv.wp.pl|timezone=Europe/Warsaw|maxdays=7.1|cultureinfo=pl-PL|charset=utf-8|titlematchfactor=60|allowlastdayoverflow}
url_index{url()|http://192.168.178.30/tv_wp_pl.php?req=1&date=|urldate|&channel=|channel|}
urldate.format {datestring|yyyy-MM-dd} 
*index_showsplit.scrub {multi(include="start")|{"id":|||}
index_showsplit.scrub {regex()||\{\"id\":.*?\}||}


*index_showsplit.scrub {multi (debug)||||}
*index_showsplit.modify {replace|\{"id":|\|\{"id":}
*index_showsplit.modify {addstart|"id":}
*index_showsplit.modify {(debug)}
*
index_start.scrub {single()|"start":"||",}
index_stop.scrub {single()|"end":"||",}
index_title.scrub {single()|"title":"||",|}
index_titleoriginal.scrub {single()|"original_title":"||",|}
index_subtitle.scrub {single()|"episode_title":"||",|}
index_temp_1.scrub {single|"season_number":||,}
index_temp_1.modify {addstart ('index_temp_1' not "")|S}
index_episode.scrub {single|"part_number":"||",}
index_episode.modify {addstart ('index_episode' not "")|E}
index_episode.modify {addstart ('index_temp_1' not "")|'index_temp_1'}
index_productiondate.scrub {single |"production_year":"||",|}
index_category.scrub {single |"genre":"||",|}
index_category.modify {cleanup}
index_title.modify {cleanup}
index_subtitle.modify {cleanup}
index_titleoriginal.modify {cleanup}
*
index_urlshow.scrub {url()|http://192.168.178.30/tv_wp_pl.php?req=2&id=|"id":"||"|","start"}
title.modify {addstart |'index_title'}
*title.scrub {single()|"title":"||",}
temp_1.scrub {multi|"short_description":"||","|}
description.scrub {multi|"long_description":"||","|}
description.scrub {multi|"episode_long_description":"||","|}
description.modify {cleanup}
description.modify {remove|\}
description.modify {replace|\||\n}
description.modify {addstart ('description' = "")|'temp_1'}
director.scrub {multi|"directors":|"name":|}|]}
director.modify {remove|"}
actor.scrub {multi|"actors":|"description":|}|]}
actor.modify {replace|","name":"| - }
actor.modify {remove|\}
actor.modify {remove|"}
*
scope.range {(showdetails)|end}
title.modify {cleanup}
subtitle.modify {cleanup}
episode.modify {cleanup}
end_scope

**  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _  _
**      #####  CHANNEL FILE CREATION (only to create the xxx-channel.xml file)
**
** @auto_xml_channel_start
*url_index {url()|http://192.168.178.30/tv_wp_pl.php?req=3}
*index_site_id.scrub {multi()|"ChannelsStore":|{"id":|,"name"|"ConfigStore"}
*index_site_channel.scrub {multi()|"ChannelsStore":|"name":"|","slug"|"ConfigStore"}}
*index_site_id.modify {cleanup(removeduplicates=equal,100 link="index_site_channel")}
** @auto_xml_channel_end

*For classical credits - remove the next lines
title.modify {remove|\}
subtitle.modify {remove|\}
description.modify {remove|\}
category.modify {cleanup(removeduplicates)}
category.modify {cleanup}
actor.modify {cleanup}
director.modify {cleanup}
actor.modify {replace|\|\||\|}
description.modify {addend('director' not "" separator=", ")|\n'director'}
description.modify {addend('actor' not "" separator="\n")|\n'actor'}
actor.modify {clear} 
director.modify {clear}

subtitle.modify {addstart ('titleoriginal' not "") | ('titleoriginal') }
subtitle.modify {addend ('episode' not "") | ('episode')}
subtitle.modify {addend ('productiondate' not "") | ('productiondate')}
subtitle.modify {addstart ('category' not "" separator=", ") |['category'] }
subtitle.modify {addend ('rating' not "") | ['rating'] }
subtitle.modify {addend ('country' not "") | ['country'] }

rating.modify {clear}
episode.modify {clear}
category.modify {clear}
productiondate.modify {clear}
titleoriginal.modify {clear}
writer.modify {clear}
producer.modify {clear}
composer.modify {clear}
starrating.modify {clear}
rating.modify {clear}
presenter.modify {clear} 
starrating.modify {clear}
videoquality.modify {clear}
videoaspect.modify {clear}
country.modify {clear}

index_title.modify {remove|\}
index_subtitle.modify {remove|\}
index_description.modify {remove|\}
index_category.modify {cleanup(removeduplicates)}
index_category.modify {cleanup}
index_description.modify {addend ('index_director' not "" separator=", " )|\n'index_director'}
index_description.modify {addend ('index_actor' not "" separator="\n" )|\n'index_actor'}
index_description.modify {addend ('index_presenter' not "" separator=", " )|\n'index_presenter'}

index_subtitle.modify {addstart ('index_titleoriginal' not "") | ('index_titleoriginal')}
index_subtitle.modify {addend ('index_episode' not "") | ('index_episode')}
index_subtitle.modify {addend ('index_productiondate' not "") | ('index_productiondate')}
index_subtitle.modify {addstart ('index_category' not "" separator=", ") |['index_category'] }
index_subtitle.modify {addend ('index_rating' not "") | ['index_rating'] }
index_writer.modify  {clear}
index_rating.modify {clear}
index_productiondate.modify {clear}
index_titleoriginal.modify {clear}
index_actor.modify {clear}
index_director.modify {clear}
index_presenter.modify {clear}
index_episode.modify {clear}
index_category.modify {clear}
index_videoquality.modify {clear}

temp_2.modify {calculate(format=F0 type=char)|'description' #}
loop{('temp_2' > "2300")|end}
description.modify {remove(type=sentence)|-1 1}
temp_2.modify {calculate(format=F0 type=char)|'description' #}
end_loop

title.modify {substring(type=char)|'title' 0 80}
subtitle.modify {substring(type=char)|'subtitle' 0 160}
index_temp_2.modify {calculate(format=F0 type=char)|'index_description' #}
loop{('index_temp_2' > "2300")|end}
index_description.modify {remove(type=sentence)|-1 1}
index_temp_2.modify {calculate(format=F0 type=char)|'index_description' #}
end_loop

index_title.modify {substring(type=char)|'index_title' 0 80}
index_subtitle.modify {substring(type=char)|'index_subtitle' 0 160}