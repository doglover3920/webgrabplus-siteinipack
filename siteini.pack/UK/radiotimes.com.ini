**------------------------------------------------------------------------------------------------
* @header_start
* WebGrab+Plus ini for grabbing EPG data from TvGuide websites
* @Site: radiotimes.com
* @MinSWversion: V2.1.4
* @Revision 1 - [07/08/2025] doglover
* @Revision 0 - [06/02/2023] doglover
*
* @Remarks:
* @header_end
**------------------------------------------------------------------------------------------------
site {url=radiotimes.com|timezone=UTC|maxdays=14|cultureinfo=en-GB|charset=UTF-8|titlematchfactor=90|retry=<retry time-out="8">2</retry>}
scope.range {(urlindex)|end}
url_index{url()|https://www.radiotimes.com/api/broadcast/broadcast/channels/|channel|/schedule?from=|urldate|T00%3A00%3A00.000Z&to=##date##T00%3A00%3A00.000Z}
global_temp_1.modify {calculate(format=date,yyyy-MM-dd)|'urldate' 1:0:0 +}
url_index.modify {replace|##date##|'global_temp_1'}
url_index.headers {customheader=Accept-Encoding=gzip,deflate}
urldate.format {datestring|yyyy-MM-dd}
end_scope
*
scope.range {(splitindex)|end}
index_showsplit.scrub {multi ()|{"id":||}
*}
index_showsplit.modify{remove(type=regex)|\!\?\?\!}
index_temp_1.modify {substring(type=regex)|'index_showsplit' "start\":\"(\d{4}-\d{1,2}-\d{1,2}T\d{2}:\d{2}:00)Z\","}
index_temp_1.modify {cleanup(removeduplicates link="index_showsplit")}
*index_showsplit.modify {(debug)}
end_scope
*
scope.range {(indexshowdetails)|end}     
index_start.scrub {regex||"start":"(\d{4}-\d{1,2}-\d{1,2}T\d{2}:\d{2}:00)Z","||}
index_stop.scrub  {regex||"end":"(\d{4}-\d{1,2}-\d{1,2}T\d{2}:\d{2}:00)Z","||}
index_title.scrub {single|"title":"||",|",}
index_temp_5.scrub {single|"tag":"||",|",}
index_title.modify{addstart('index_temp_5' = "Live")|LIVE: }
index_category.scrub {single(separator="","")|"genre":["||"]|"]}
index_temp_1.scrub {single(include="film")|"type":"||"|"}
index_category.modify {cleanup(style=name)}
if {('index_temp_1' not "")|end}
index_category.modify {replace|\||#_#}
index_category.modify {replace|#_#|\|}
end_if
index_temp_2.scrub {regex()||^"(.*?)",||}
global_temp_4.modify {set|'index_temp_2'}
index_urlshow {url()||"url":"||",|",}
index_urlshow.headers {customheader=Accept-Encoding=gzip,deflate}
index_urlshow.headers {accept=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9}
end_scope

scope.range{(showdetails)|end}
title.modify {addstart('title' = "")|'index_title'}
temp_1.modify{set|'index_temp_2'}
subtitle.scrub {single|{"id":"'global_temp_4'"|"subtitle":"|",|</script>}
*}
subtitle.modify {cleanup(removeduplicates)}
subtitle.modify {cleanup(style=jsondecode)}
subtitle.modify{clear(~ 'title')}
description.scrub {single|article":{"id":"'global_temp_4'"|"description":"|",|</script>}
*}
description.modify {cleanup(tags="<"">")} 
description.modify {cleanup(removeduplicates)}
description.modify {cleanup}
*description.modify {replace|\||\n}
actor.scrub {multi (separator="},{") |article":{"id":"'global_temp_4'"|"cast":[|]|</script>}
*}
actor.modify {remove|"name":}
actor.modify {replace|","role":"| - }
actor.modify {remove|"}
actor.modify {remove|\{}
actor.modify {remove|\}}
actor.modify {cleanup(removeduplicates)}
director.scrub {multi (separator="},{" include="director") |article":{"id":"'global_temp_4'"|"crew":[|]|</script>}
*}
director.modify {remove|"name":}
director.modify {replace|","role":"| - }
director.modify {remove|"}
director.modify {remove|\{}
director.modify {remove|\}}
director.modify {cleanup(removeduplicates)}

rating.scrub {regex||"contentRating":"([^"]*)",||}
productiondate.scrub {regex()||"datePublished":"(\d{4})",||}
temp_5.scrub{regex||<li class="labels__label.*?>(\d{4})</li>||}
temp_6.scrub{regex||<dd class="d-inline ml-xxs">(\d{4})-\d{2}-\d{2}</dd>||}
temp_6.modify {clear ('temp_6' = 'temp_5')}
productiondate.modify{addend('productiondate' "")|'temp_5'}
productiondate.modify{replace|\||, }
temp_2.scrub {regex()||\{"level":\d+,"value":"(Episode \d+)"\}||}
temp_4.scrub {regex()||\{"value":"(Episode \d+)","size":".+?","bold":true\}||}
temp_3.scrub {regex()||\{"level":\d+,"value":"(\d+) episodes"}||}
temp_3.modify {addstart('temp_3' not "")|/}
episode.scrub{regex()||\{"label":"(Season \d+)"\}||}
episode.modify {addend ()|\|'temp_2'\|'temp_3'\|'temp_4'}
episode.modify {cleanup(removeduplicates)}
episode.modify {replace|Season|S}
episode.modify {replace|Episode|E}
episode.modify {remove| }
episode.modify {cleanup ()}
episode.modify {replace|\||
rating.modify {remove|' Certificate'}
rating.scrub{single|"contentRating":"||",|",}
rating.modify {cleanup(removeduplicates)}
starrating.scrub {single|"reviewRating":{"@type":"Rating","ratingValue":"||"|}}
*}
end_scope

**      #####  CHANNEL FILE CREATION (only to create the xxx-channel.xml file)
**   
** @auto_xml_channel_start
*url_index {url()|https://www.radiotimes.com/api/broadcast/broadcast/channels/video?provider=|subpage|}

*subpage.format {list|skyhd&region=hnvr|skyhd&region=hnvs|skyhd&region=hnvt|skyhd&region=hnvv|skyhd&region=hnvw|skyhd&region=hnvx|skyhd&region=hnvy|skyhd&region=hnvz|skyhd&region=hnv2|skyhd&region=hnv4|skyhd&region=hnv5|skyhd&region=hnv6|skyhd&region=hnv7|skyhd&region=hnv8|skyhd&region=hnwb|skyhd&region=hnwc|skyhd&region=hnv9|skyhd&region=hnwd|skyhd&region=hnwf|skyhd&region=hnwg|skyhd&region=hnwh|skyhd&region=hnwj|skyhd&region=hnwk|skyhd&region=hnwm|skyhd&region=hnwn|skyhd&region=hnwp|skyhd&region=hnwq|skyhd&region=hnwr|skyhd&region=hnws}

*subpage.format {list|freesat&region=hng5|freesat&region=hng6|freesat&region=hng7|freesat&region=hng8|freesat&region=hng9|freesat&region=hnhb|freesat&region=hnhd|freesat&region=hnhc|freesat&region=hnhf|freesat&region=hnhg|freesat&region=hnhh|freesat&region=hnhj|freesat&region=hnhk|freesat&region=hnhm|freesat&region=hnhn|freesat&region=hnhp|freesat&region=hnhq|freesat&region=hnhr|freesat&region=hnhs|freeview&region=hnhv|freeview&region=hnhw|freeview&region=hnhx|freeview&region=hnhy|freeview&region=hnhz|freeview&region=hnh2|freeview&region=hnh4|freeview&region=hnh6|freeview&region=hnh5|freeview&region=hnh7|freeview&region=hnh8|freeview&region=hnh9|freeview&region=hnjb|freeview&region=hnjc|freeview&region=hnjd|freeview&region=hnjf|freeview&region=hnjg|freeview&region=hnjh|freeview&region=hnjj|freeview&region=hnjk|freeview&region=hnjm}

*subpage.format {list|default&region=hnq5|default&region=hnq6|default&region=hnq7|default&region=hnq8|default&region=hnq9|default&region=hnrb|default&region=hnrc|default&region=hnrd|default&region=hnrf|default&region=hnrg|default&region=hnrh|default&region=hnrj|default&region=hnrk|default&region=hnrm|default&region=hnrn|default&region=hnrp|default&region=hnrq|default&region=hnrr|default&region=hnrs|default&region=hnrt|default&region=hnrv|default&region=hnrw|default&region=hnry|default&region=hnr2|default&region=hnr5|default&region=hnr4|default&region=hnr6|default&region=hnr7|default&region=hnrz|bttv&region=hngb|bttv&region=hngc|bttv&region=hngd|bttv&region=hngf|bttv&region=hngg|bttv&region=hngh|bttv&region=hngj|bttv&region=hngm|bttv&region=hngk|bttv&region=hngn|bttv&region=hngp|bttv&region=hngq|bttv&region=hngr|bttv&region=hngs|bttv&region=hngt|bttv&region=hngv|bttv&region=hngw|bttv&region=hngx|bttv&region=hngy|bttv&region=hngz|bttv&region=hng2|freesat&region=hng5|freesat&region=hng6|freesat&region=hng7|freesat&region=hng8|freesat&region=hng9|freesat&region=hnhb|freesat&region=hnhd|freesat&region=hnhc|freesat&region=hnhf|freesat&region=hnhg|freesat&region=hnhh|freesat&region=hnhj|freesat&region=hnhk|freesat&region=hnhm|freesat&region=hnhn|freesat&region=hnhp|freesat&region=hnhq|freesat&region=hnhr|freesat&region=hnhs|freeview&region=hnhv|freeview&region=hnhw|freeview&region=hnhx|freeview&region=hnhy|freeview&region=hnhz|freeview&region=hnh2|freeview&region=hnh4|freeview&region=hnh6|freeview&region=hnh5|freeview&region=hnh7|freeview&region=hnh8|freeview&region=hnh9|freeview&region=hnjb|freeview&region=hnjc|freeview&region=hnjd|freeview&region=hnjf|freeview&region=hnjg|freeview&region=hnjh|freeview&region=hnjj|freeview&region=hnjk|freeview&region=hnjm|sky&region=hnjt|sky&region=hnjv|sky&region=hnjw|sky&region=hnjx|sky&region=hnjy|sky&region=hnjz|sky&region=hnj2|sky&region=hnj4|sky&region=hnj5|sky&region=hnj6|sky&region=hnj7|sky&region=hnj8|sky&region=hnj9|sky&region=hnkb|sky&region=hnkd|sky&region=hnkf|sky&region=hnkc|sky&region=hnkg|sky&region=hnkh|sky&region=hnkj|sky&region=hnkk|sky&region=hnkm|sky&region=hnkn|sky&region=hnkp|sky&region=hnkq|sky&region=hnkr|sky&region=hnks|sky&region=hnkt|sky&region=hnkv|skyhd&region=hnvr|skyhd&region=hnvs|skyhd&region=hnvt|skyhd&region=hnvv|skyhd&region=hnvw|skyhd&region=hnvx|skyhd&region=hnvy|skyhd&region=hnvz|skyhd&region=hnv2|skyhd&region=hnv4|skyhd&region=hnv5|skyhd&region=hnv6|skyhd&region=hnv7|skyhd&region=hnv8|skyhd&region=hnwb|skyhd&region=hnwc|skyhd&region=hnv9|skyhd&region=hnwd|skyhd&region=hnwf|skyhd&region=hnwg|skyhd&region=hnwh|skyhd&region=hnwj|skyhd&region=hnwk|skyhd&region=hnwm|skyhd&region=hnwn|skyhd&region=hnwp|skyhd&region=hnwq|skyhd&region=hnwr|skyhd&region=hnws|talktalk&region=hnky|talktalk&region=hnkz|talktalk&region=hnk2|talktalk&region=hnk4|talktalk&region=hnk5|talktalk&region=hnk6|talktalk&region=hnk7|talktalk&region=hnk9|talktalk&region=hnk8|talktalk&region=hnmb|talktalk&region=hnmc|talktalk&region=hnmd|talktalk&region=hnmf|talktalk&region=hnmg|talktalk&region=hnmh|talktalk&region=hnmj|talktalk&region=hnmk|talktalk&region=hnmm|talktalk&region=hnmn|talktalk&region=hnmp|talktalk&region=hnmq|virgin&region=hnms|virgin&region=hnmt|virgin&region=hnmv|virgin&region=hnmw|virgin&region=hnmx|virgin&region=hnmz|virgin&region=hnmy|virgin&region=hnm2|virgin&region=hnm4|virgin&region=hnm5|virgin&region=hnm6|virgin&region=hnm7|virgin&region=hnm8|virgin&region=hnm9|virgin&region=hnnb|virgin&region=hnnc|virgin&region=hnnd|virgin&region=hnnf|virgin&region=hnng|youview&region=hnnj|youview&region=hnnk|youview&region=hnnm|youview&region=hnnn|youview&region=hnnp|youview&region=hnnq|youview&region=hnnr|youview&region=hnnt|youview&region=hnns|youview&region=hnnv|youview&region=hnnw|youview&region=hnnx|youview&region=hnny|youview&region=hnnz|youview&region=hnn2|youview&region=hnn4|youview&region=hnn5|youview&region=hnn6|youview&region=hnn7|youview&region=hnn8|youview&region=hnn9}
*index_site_id.scrub {multi ()|"id":"||",|",}
*index_site_channel.scrub {multi|"title":"||",|",}
*index_site_id.modify {cleanup(removeduplicates=equal,100 link="index_site_channel")}
** @auto_xml_channel_end
*For classical credits - remove the next lines
index_title.modify {remove|\}
index_subtitle.modify {remove|\}
index_description.modify {remove|\}
index_category.modify {cleanup(removeduplicates)}
index_category.modify {cleanup}
index_subtitle.modify {cleanup}
index_temp_4.modify {set|'index_category'}
index_temp_5.modify {set|'index_subtitle'}
index_temp_6.modify {set|'index_episode'}
index_temp_7.modify {set|'index_productiondate'}
index_temp_8.modify {set|'index_rating'}
index_subtitle.modify {clear}
index_writer.modify  {clear}
index_rating.modify {clear}
index_productiondate.modify {clear}
index_titleoriginal.modify {clear}
index_actor.modify {clear}
index_director.modify {clear}
index_presenter.modify {clear}
index_episode.modify {clear}
index_category.modify {clear}
index_videoquality.modify {clear}

title.modify {remove|\}
subtitle.modify {remove|\}
description.modify {remove|\}
category.modify {cleanup(removeduplicates)}
category.modify {cleanup}
actor.modify {cleanup}
director.modify {cleanup}
director.modify {cleanup (removeduplicates)}
actor.modify {replace|\|\||\|}
description.modify {addend('director' not "" separator="\n")|\n'director'}
description.modify {addend('actor' not "" separator="\n")|\n'actor'}
actor.modify {clear} 
director.modify {clear}
temp_9.modify {addstart ('episode' not "") | ║ 'episode'}
temp_9.modify {addstart ('index_temp_6' not "") | ║ 'index_temp_6'}
temp_9.modify {addend ('subtitle' not "") | ║ 'subtitle'}
temp_9.modify {addend ('index_temp_5' not "") | ║ 'index_temp_5'}
temp_9.modify {addend ('titleoriginal' not "") | ║ 'titleoriginal'}
temp_9.modify {addend ('category' not "" separator=", ") | ║ 'category'}
temp_9.modify {addend ('index_temp_4' not "" separator=", ") | ║ 'index_temp_4'}
temp_9.modify {addend ('country' not "" separator=", ") | ║ 'country'}
temp_9.modify {addend ('productiondate' not "") | ║ 'productiondate'}
temp_9.modify {addend ('index_temp_7' not "") | ║ 'index_temp_7'}
temp_9.modify {addend ('rating' not "") | ║ 'rating'}
temp_9.modify {addend ('index_temp_8' not "") | ║ 'index_temp_8'}
temp_9.modify {remove (type=regex)|^ ║ }
subtitle.modify {set ('temp_9' not "")|'temp_9'}
rating.modify {clear}
episode.modify {clear}
category.modify {clear}
productiondate.modify {clear}
titleoriginal.modify {clear}
writer.modify {clear}
producer.modify {clear}
composer.modify {clear}
starrating.modify {clear}
rating.modify {clear}
presenter.modify {clear} 
starrating.modify {clear}
videoquality.modify {clear}
videoaspect.modify {clear}
country.modify {clear}

temp_2.modify {calculate(format=F0 type=char)|'description' #}
loop{('temp_2' > "2300")|end}
description.modify {remove(type=sentence)|-1 1}
temp_2.modify {calculate(format=F0 type=char)|'description' #}
end_loop
title.modify {substring(type=char)|'title' 0 120}
subtitle.modify {substring(type=char)|'subtitle' 0 120}
index_title.modify {substring(type=char)|'index_title' 0 120}